<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut Validation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#quickStart"><strong>3</strong><span>Quick Start</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#methodsValidation"><strong>4</strong><span>Validating Bean Methods</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#dataClassesValidation"><strong>5</strong><span>Validating Data Classes</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#configurationValidation"><strong>6</strong><span>Validating Configuration Properties</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#additionalConstraints"><strong>7</strong><span>Defining Additional Constraints</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#compileTimeValidation"><strong>8</strong><span>Validating Annotations at Compile Time</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repository"><strong>9</strong><span>Repository</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-releaseHistory"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-quickStart"><a href="#quickStart"><strong>3</strong><span>Quick Start</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-methodsValidation"><a href="#methodsValidation"><strong>4</strong><span>Validating Bean Methods</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-dataClassesValidation"><a href="#dataClassesValidation"><strong>5</strong><span>Validating Data Classes</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-configurationValidation"><a href="#configurationValidation"><strong>6</strong><span>Validating Configuration Properties</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-additionalConstraints"><a href="#additionalConstraints"><strong>7</strong><span>Defining Additional Constraints</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-compileTimeValidation"><a href="#compileTimeValidation"><strong>8</strong><span>Validating Annotations at Compile Time</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repository"><a href="#repository"><strong>9</strong><span>Repository</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut Validation</h1>
        <p></p>
        <p>Validation support for Micronaut</p>
        <p><strong>Version:</strong> 4.8.1-SNAPSHOT </p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Validation is a customizable validation solution for your applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut Validation was moved to a separate module for Micronaut version 4.0.0. For previous versions of Micronaut, refer to the <a href="https://docs.micronaut.io/latest/guide/">Micronaut User Guide</a>.
</td>
</tr>
</table>
</div>

<h1 id="releaseHistory"><a class="anchor" href="#releaseHistory"></a>2 Release History</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/releaseHistory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For this project, you can find a list of releases (with release notes) here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-validation/releases">https://github.com/micronaut-projects/micronaut-validation/releases</a></p>
</div>

<h1 id="quickStart"><a class="anchor" href="#quickStart"></a>3 Quick Start</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/quickStart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use the Micronautâ€™s validation capabilities you must have the validation dependency on your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.validation:micronaut-validation-processor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.validation&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-validation-processor&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.validation:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.validation&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>You can validate types, fields and parameters by applying <code>jakarta.validation</code> annotations to arguments. The <code>jakarta.validation-api</code> library exposes those annotations, but it unnecessary to specify it as a direct dependency. It is included transitively when using <code>micronaut-validation</code>.</p>
</div>
<div class="sect1">
<h2 id="_supported_features">Supported Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note that Micronaut&#8217;s implementation is not currently fully compliant with the <a href="https://beanvalidation.org/2.0/spec/">Bean Validator specification</a> as the specification heavily relies on reflection-based APIs.</p>
</div>
<div class="paragraph">
<p>The following features are unsupported at this time:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any interaction with the <a href="https://beanvalidation.org/2.0/spec/#constraintmetadata">constraint metadata API</a>, since Micronaut uses compile-time generated metadata.</p>
</li>
<li>
<p>XML-based configuration</p>
</li>
<li>
<p>Instead of using <code>jakarta.validation.ConstraintValidator</code>, use <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> (io.micronaut.validation.validator.constraints.ConstraintValidator) to define custom constraints, which supports validating annotations at compile time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s implementation includes the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reflection and Runtime Proxy free validation, resulting in reduced memory consumption</p>
</li>
<li>
<p>Smaller JAR size since Hibernate Validator adds another 1.4MB</p>
</li>
<li>
<p>Faster startup since Hibernate Validator adds 200ms+ startup overhead</p>
</li>
<li>
<p>Configurability via Annotation Metadata</p>
</li>
<li>
<p>Support for Reactive Bean Validation</p>
</li>
<li>
<p>Support for validating the source AST at compile time</p>
</li>
<li>
<p>Automatic compatibility with GraalVM native without additional configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you require full Bean Validator 2.0 compliance, add the <code>micronaut-hibernate-validator</code> module to your build, which replaces Micronaut&#8217;s implementation.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.beanvalidation:micronaut-hibernate-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.beanvalidation&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
</div>
</div>

<h1 id="methodsValidation"><a class="anchor" href="#methodsValidation"></a>4 Validating Bean Methods</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/methodsValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can validate methods of any class declared as a Micronaut bean by applying <code>jakarta.validation</code> annotations to arguments:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Validating Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Singleton;

import jakarta.validation.constraints.NotBlank;

@Singleton
public class PersonService {
    public void sayHello(@NotBlank String name) {
        System.out.println("Hello " + name);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Validating Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Singleton
import jakarta.validation.constraints.NotBlank

@Singleton
class PersonService {
    void sayHello(@NotBlank String name) {
        println "Hello $name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Validating Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Singleton
import jakarta.validation.constraints.NotBlank

@Singleton
open class PersonService {
    open fun sayHello(@NotBlank name: String) {
        println("Hello $name")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example declares that the <code>@NotBlank</code> annotation will be validated when invoking the <code>sayHello</code> method.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you use Kotlin, the class and method must be declared <code>open</code> so Micronaut can create a compile-time subclass. Alternatively you can annotate the class with <a href="../api/io/micronaut/validation/Validated.html">@Validated</a> and configure the Kotlin <code>all-open</code> plugin to open classes annotated with this type. See the <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html">Compiler plugins</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <code>jakarta.validation.ConstraintViolationException</code> is thrown if a validation error occurs. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import org.junit.jupiter.api.Test;

import jakarta.validation.ConstraintViolationException;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;

@MicronautTest
class PersonServiceSpec {

    @Inject PersonService personService;

    @Test
    void testThatNameIsValidated() {
        final ConstraintViolationException exception =
                assertThrows(ConstraintViolationException.class, () -&gt;
                personService.sayHello("") // <b class="conum">(1)</b>
        );

        assertEquals("sayHello.name: must not be blank", exception.getMessage()); // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.test.extensions.spock.annotation.MicronautTest
import spock.lang.Specification

import jakarta.inject.Inject
import jakarta.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec extends Specification {

    @Inject PersonService personService

    void "test person name is validated"() {
        when:"The sayHello method is called with a blank string"
        personService.sayHello("") // <b class="conum">(1)</b>

        then:"A validation error occurs"
        def e = thrown(ConstraintViolationException)
        e.message == "sayHello.name: must not be blank" //  <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Assertions.assertThrows
import org.junit.jupiter.api.Test
import jakarta.inject.Inject
import jakarta.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec {

    @Inject
    lateinit var personService: PersonService

    @Test
    fun testThatNameIsValidated() {
        val exception = assertThrows(ConstraintViolationException::class.java) {
            personService.sayHello("") // <b class="conum">(1)</b>
        }

        assertEquals("sayHello.name: must not be blank", exception.message) // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is called with a blank string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An exception occurs</td>
</tr>
</table>
</div>

<h1 id="dataClassesValidation"><a class="anchor" href="#dataClassesValidation"></a>5 Validating Data Classes</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/dataClassesValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To validate data classes, e.g. POJOs (typically used in JSON interchange), the class must be annotated with <a href="https://docs.micronaut.io/latest/api/io/micronaut/core/annotation/Introspected">@Introspected</a> (see <a href="https://docs.micronaut.io/latest/guide/#introspection">Micronaut Guide Introspection section</a>) or, if the class is external, be imported by the <code>@Introspected</code> annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">POJO Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotBlank;

@Introspected
public class Person {

    private String name;

    @Min(18)
    private int age;

    @NotBlank
    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">POJO Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

import jakarta.validation.constraints.Min
import jakarta.validation.constraints.NotBlank

@Introspected
class Person {

    @NotBlank
    String name

    @Min(18L)
    int age
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">POJO Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Introspected
import jakarta.validation.constraints.Min
import jakarta.validation.constraints.NotBlank

@Introspected
data class Person(
    @field:NotBlank var name: String,
    @field:Min(18) var age: Int
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="https://docs.micronaut.io/latest/api/io/micronaut/core/annotation/Introspected">@Introspected</a> annotation can be used as a meta-annotation; common annotations like <code>@jakarta.persistence.Entity</code> are treated as <code>@Introspected</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example defines a <code>Person</code> class that has two properties (<code>name</code> and <code>age</code>) that have constraints applied. Note that in Java the annotations can be on the field or the getter, and with Kotlin data classes, the annotation should target the field.</p>
</div>
<div class="paragraph">
<p>To validate the class manually, inject an instance of <a href="../api/io/micronaut/validation/validator/Validator.html">Validator</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
Validator validator;

@Test
void testThatPersonIsValidWithValidator() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final Set&lt;ConstraintViolation&lt;Person&gt;&gt; constraintViolations = validator.validate(person);  // <b class="conum">(1)</b>

    assertEquals(2, constraintViolations.size()); // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject Validator validator

void "test person is validated with validator"() {
    when:"The person is validated"
    def constraintViolations = validator.validate(new Person(name: "", age: 10)) // <b class="conum">(1)</b>

    then:"A validation error occurs"
    constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
lateinit var validator: Validator

@Test
fun testThatPersonIsValidWithValidator() {
    val person = Person("", 10)
    val constraintViolations = validator.validate(person) // <b class="conum">(1)</b>

    assertEquals(2, constraintViolations.size) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The validator validates the person</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively on Bean methods you can use <code>jakarta.validation.Valid</code> to trigger cascading validation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class PersonService {
    public void sayHello(@Valid Person person) {
        System.out.println("Hello " + person.getName());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class PersonService {
    void sayHello(@Valid Person person) {
        println "Hello $person.name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
open class PersonService {
    open fun sayHello(@Valid person: Person) {
        println("Hello ${person.name}")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonService</code> now validates the <code>Person</code> class when invoked:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
PersonService personService;

@Test
void testThatPersonIsValid() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final ConstraintViolationException exception =
        assertThrows(ConstraintViolationException.class, () -&gt;
            personService.sayHello(person) // <b class="conum">(1)</b>
        );

    assertEquals(2, exception.getConstraintViolations().size()); // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject PersonService personService

void "test person name is validated"() {
    when:"The sayHello method is called with an invalid person"
    personService.sayHello(new Person(name: "", age: 10)) // <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
lateinit var personService: PersonService

@Test
fun testThatPersonIsValid() {
    val person = Person("", 10)
    val exception = assertThrows(ConstraintViolationException::class.java) {
        personService.sayHello(person) // <b class="conum">(1)</b>
    }

    assertEquals(2, exception.constraintViolations.size) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A validated method is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can validate values of Java iterables, like <code>List</code>, <code>Set</code> and <code>Map</code> by defining validation annotations on generic parameters.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Iterables Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class BookInfoService {
    public void setBookAuthors(
        @NotBlank String bookName,
        List&lt;@NotBlank String&gt; authors // <b class="conum">(1)</b>
    ) {
        System.out.println("Set book authors for book " + bookName);
    }

    public void setBookSectionPages(
        @NotBlank String bookName,
        Map&lt;@NotBlank String, @Min(1) Integer&gt; sectionStartPages // <b class="conum">(2)</b>
    ) {
        System.out.println("Set the start pages for all sections of book " + bookName);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Iterables Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class BookInfoService {
    void setBookAuthors(
        @NotBlank String bookName,
        List&lt;@NotBlank String&gt; authors // <b class="conum">(1)</b>
    ) {
        println("Set book authors for book " + bookName)
    }

    void setBookSectionPages(
        @NotBlank String bookName,
        Map&lt;@NotBlank String, @Min(1) Integer&gt; sectionStartPages // <b class="conum">(2)</b>
    ) {
        println("Set the start pages for all sections of book " + bookName)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Iterables Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
open class BookInfoService {
    open fun setBookAuthors(
        bookName: @NotBlank String,
        authors: List&lt;@NotBlank String&gt; // <b class="conum">(1)</b>
    ) {
        println("Set book authors for book $bookName")
    }

    open fun setBookSectionPages(
        bookName: @NotBlank String,
        sectionStartPages: Map&lt;@NotBlank String, @Min(1) Int&gt;  // <b class="conum">(2)</b>
    ) {
        println("Set the start pages for all sections of book $bookName")
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>List items will be validated with given annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Both keys and values of Map will be validated</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
void testAuthorNamesAreValidated() {
    final List&lt;String&gt; authors = Arrays.asList("Me", "");

    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    bookInfoService.setBookAuthors("My Book", authors)
            );

    assertEquals("setBookAuthors.authors[1]&lt;list element&gt;: must not be blank",
            exception.getMessage()); // <b class="conum">(1)</b>
}

@Test
void testSectionsAreValidated() {
    final Map&lt;String, Integer&gt; sectionStartPages = new HashMap&lt;&gt;();
    sectionStartPages.put("", 1);

    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    bookInfoService.setBookSectionPages("My Book", sectionStartPages)
            );

    assertEquals("setBookSectionPages.sectionStartPages[]&lt;map key&gt;: must not be blank",
            exception.getMessage()); // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">void testAuthorNamesAreValidated() {
    given:
    List&lt;String&gt; authors = ["Me", ""]

    when:
    bookInfoService.setBookAuthors("My Book", authors)

    then:
    ConstraintViolationException exception = thrown()
    "setBookAuthors.authors[1]&lt;list element&gt;: must not be blank" == exception.message // <b class="conum">(1)</b>
}

void testSectionsAreValidated() {
    given:
    Map&lt;String, Integer&gt; sectionStartPages = new HashMap&lt;&gt;()
    sectionStartPages.put("", 1)

    when:
    bookInfoService.setBookSectionPages("My Book", sectionStartPages)

    then:
    ConstraintViolationException exception = thrown()
    "setBookSectionPages.sectionStartPages[]&lt;map key&gt;: must not be blank" == exception.message // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Test
fun testAuthorNamesAreValidated() {
    val authors: List&lt;String&gt; = mutableListOf("Me", "")
    val exception = Assertions.assertThrows(
        ConstraintViolationException::class.java
    ) { bookInfoService.setBookAuthors("My Book", authors) }
    Assertions.assertEquals(
        "setBookAuthors.authors[1]&lt;list element&gt;: must not be blank",
        exception.message
    ) // <b class="conum">(1)</b>
}

@Test
fun testSectionsAreValidated() {
    val sectionStartPages: MutableMap&lt;String, Int&gt; = HashMap()
    sectionStartPages[""] = 1
    val exception = Assertions.assertThrows(
        ConstraintViolationException::class.java
    ) {
        bookInfoService.setBookSectionPages(
            "My Book",
            sectionStartPages
        )
    }
    Assertions.assertEquals(
        "setBookSectionPages.sectionStartPages[]&lt;map key&gt;: must not be blank",
        exception.message
    ) // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The violation on the 1-st index in List</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The violation was found in Map&#8217;s key</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is not yet supported in Groovy and Kotlin
</td>
</tr>
</table>
</div>

<h1 id="configurationValidation"><a class="anchor" href="#configurationValidation"></a>6 Validating Configuration Properties</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/configurationValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can also validate the properties of classes that are annotated with <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/ConfigurationProperties">@ConfigurationProperties</a> to ensure configuration is correct.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended that you annotate <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/ConfigurationProperties">@ConfigurationProperties</a> that features validation with <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/Context">@Context</a> to ensure that the validation occurs at startup.
</td>
</tr>
</table>
</div>

<h1 id="additionalConstraints"><a class="anchor" href="#additionalConstraints"></a>7 Defining Additional Constraints</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/additionalConstraints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To define additional constraints, create a new annotation, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.validation.Constraint;
import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.CONSTRUCTOR;
import static java.lang.annotation.ElementType.FIELD;
import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.ElementType.PARAMETER;
import static java.lang.annotation.ElementType.TYPE_USE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Retention(RUNTIME)
@Constraint(validatedBy = { MyValidatorBean.class }) // <b class="conum">(1)</b>
public @interface DurationPattern {

    String message() default "invalid duration ({validatedValue})"; // <b class="conum">(2)</b>

    /**
     * Defines several constraints on the same element.
     */
    @Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
    @Retention(RUNTIME)
    @Documented
    @interface List {
        DurationPattern[] value(); // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.validation.Constraint
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Retention(RUNTIME)
@Constraint(validatedBy = [ MyValidatorBean ]) // <b class="conum">(1)</b>
@interface DurationPattern {
    String message() default "invalid duration ({validatedValue})" // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.validation.Constraint
import kotlin.annotation.AnnotationRetention.RUNTIME

@Retention(RUNTIME)
@Constraint(validatedBy = []) // <b class="conum">(1)</b>
annotation class DurationPattern(
    val message: String = "invalid duration ({validatedValue})" // <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation should be annotated with <code>jakarta.validation.Constraint</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>message</code> template can be provided in a hard-coded manner as above. If none is specified, Micronaut tries to find a message using <code>ClassName.message</code> using the <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/MessageSource">MessageSource</a> interface (optional)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To support repeated annotations you can define an inner annotation (optional)</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add messages and message bundles using the <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/MessageSource">MessageSource</a> and <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/i18n/ResourceBundleMessageSource">ResourceBundleMessageSource</a> classes. See <a href="https://docs.micronaut.io/latest/guide/#bundle">Resource Bundles</a> documentation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A constraint with an empty <code>validatedBy = {}</code> will use the bean context to find a bean of <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> with a generic value of your annotation, or it&#8217;s possible to set <code>validatedBy = MyConstraintValidator.class</code> and in this case the validator can be an introspected bean or a simple bean in loaded from the bean context.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined the annotation, implement a <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> that validates the annotation. You can either create a bean class that implements the interface directly or define a factory that returns one or more validators.</p>
</div>
<div class="paragraph">
<p>The former approach can be taken for single bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.AnnotationValue;
import io.micronaut.core.annotation.Introspected;
import io.micronaut.core.annotation.NonNull;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.validation.validator.constraints.ConstraintValidator;
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext;
import jakarta.inject.Singleton;

@Singleton
@Introspected
public class MyValidatorBean implements ConstraintValidator&lt;DurationPattern, Object&gt; {

    @Override
    public boolean isValid(@Nullable Object value,
                           @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
                           @NonNull ConstraintValidatorContext context) {
        context.messageTemplate("invalid duration ({validatedValue}), additional custom message"); // (1)
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.core.annotation.Introspected
import io.micronaut.core.annotation.NonNull
import io.micronaut.core.annotation.Nullable
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext
import jakarta.inject.Singleton

@Singleton
@Introspected
class MyValidatorBean implements ConstraintValidator&lt;DurationPattern, Object&gt; {

    @Override
    boolean isValid(@Nullable Object value,
                    @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
                    @NonNull ConstraintValidatorContext context) {
        context.messageTemplate("invalid duration ({validatedValue}), additional custom message") // <b class="conum">(1)</b>
        return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.core.annotation.Introspected
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext
import jakarta.inject.Singleton

@Singleton
@Introspected
class MyValidatorBean : ConstraintValidator&lt;DurationPattern, Any&gt; {

    override fun isValid(value: Any?,
                         annotationMetadata: AnnotationValue&lt;DurationPattern&gt;,
                         context: ConstraintValidatorContext) : Boolean {
        context.messageTemplate("invalid duration ({validatedValue}), additional custom message") // (1)
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override the default message template with an inline call for more control over the validation error message. (Since <code>2.5.0</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The latter approach is recommended if you plan to define multiple validators:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator Factory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Factory;
import io.micronaut.validation.validator.constraints.ConstraintValidator;
import jakarta.inject.Singleton;

@Factory
public class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, Object&gt; durationPatternValidator() {
        return (value, annotationMetadata, context) -&gt; {
            context.messageTemplate("invalid duration ({validatedValue}), additional custom message"); // <b class="conum">(1)</b>
            return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
        };
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator Factory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext

import jakarta.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, CharSequence&gt; durationPatternValidator() {
        return { CharSequence value,
                 AnnotationValue&lt;DurationPattern&gt; annotation,
                 ConstraintValidatorContext context -&gt;
            context.messageTemplate("invalid duration ({validatedValue}), additional custom message") // <b class="conum">(1)</b>
            return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
        } as ConstraintValidator&lt;DurationPattern, CharSequence&gt;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator Factory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import io.micronaut.validation.validator.constraints.ConstraintValidator
import jakarta.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    fun durationPatternValidator() : ConstraintValidator&lt;DurationPattern, Any&gt; {
        return ConstraintValidator { value, _, context -&gt;
            context.messageTemplate("invalid duration ({validatedValue}), additional custom message") // <b class="conum">(1)</b>
            value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override the default message template with an inline call for more control over the validation error message. (Since <code>2.5.0</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example implements a validator that validates any field, parameter etc. that is annotated with <code>DurationPattern</code>, ensuring that the string can be parsed with <code>java.time.Duration.parse</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generally <code>null</code> is regarded as valid and <code>@NotNull</code> is used to constrain a value as not being <code>null</code>. The example above regards <code>null</code> as a valid value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class HolidayService {

    @Executable
    public String startHoliday(@NotBlank String person,
                               @DurationPattern String duration) {
        final Duration d = Duration.parse(duration);
        return "Person " + person + " is off on holiday for " + d.toMinutes() + " minutes";
    }

    public String startHoliday(@DurationPattern String fromDuration, @DurationPattern String toDuration, @NotBlank String person
    ) {
        final Duration d = Duration.parse(fromDuration);
        final Duration e = Duration.parse(toDuration);
        return "Person " + person + " is off on holiday from " + d + " to " + e;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class HolidayService {

    String startHoliday(@NotBlank String person,
                        @DurationPattern String duration) {
        final Duration d = Duration.parse(duration)
        return "Person $person is off on holiday for ${d.toMinutes()} minutes"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
open class HolidayService {

    open fun startHoliday(@NotBlank person: String,
                          @DurationPattern duration: String): String {
        val d = Duration.parse(duration)
        return "Person $person is off on holiday for ${d.toMinutes()} minutes"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the above examples validates the <code>duration</code> parameter, define a test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject HolidayService holidayService;

@Test
void testCustomValidator() {
    final ConstraintViolationException exception =
        assertThrows(ConstraintViolationException.class, () -&gt;
            holidayService.startHoliday("Fred", "junk") // <b class="conum">(1)</b>
        );

    assertEquals("startHoliday.duration: invalid duration (junk), additional custom message", exception.getMessage()); // <b class="conum">(2)</b>
}

// Issue:: micronaut-core/issues/6519
@Test
void testCustomAndDefaultValidator() {
    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    holidayService.startHoliday( "fromDurationJunk", "toDurationJunk", "")
            );

    String notBlankValidated = exception.getConstraintViolations().stream().filter(constraintViolation -&gt; Objects.equals(constraintViolation.getPropertyPath().toString(), "startHoliday.person")).map(ConstraintViolation::getMessage).findFirst().get();
    String fromDurationPatternValidated = exception.getConstraintViolations().stream().filter(constraintViolation -&gt; Objects.equals(constraintViolation.getPropertyPath().toString(), "startHoliday.fromDuration")).map(ConstraintViolation::getMessage).findFirst().get();
    String toDurationPatternValidated = exception.getConstraintViolations().stream().filter(constraintViolation -&gt; Objects.equals(constraintViolation.getPropertyPath().toString(), "startHoliday.toDuration")).map(ConstraintViolation::getMessage).findFirst().get();
    assertEquals("must not be blank", notBlankValidated);
    assertEquals("invalid duration (fromDurationJunk), additional custom message", fromDurationPatternValidated);
    assertEquals("invalid duration (toDurationJunk), additional custom message", toDurationPatternValidated);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">void "test test custom validator"() {
    when:"A custom validator is used"
    holidayService.startHoliday("Fred", "junk") // <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.message == "startHoliday.duration: invalid duration (junk), additional custom message" //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
lateinit var holidayService: HolidayService

@Test
fun testCustomValidator() {
    val exception = assertThrows(ConstraintViolationException::class.java) {
        holidayService.startHoliday("Fred", "junk") // <b class="conum">(1)</b>
    }

    assertEquals("startHoliday.duration: invalid duration (junk), additional custom message", exception.message) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A validated method is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>THe constraint violations are verified</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the guide for <a href="https://guides.micronaut.io/latest/micronaut-custom-validation-annotation.html">Custom Constraint Annotation for Validation</a> to learn more.
</td>
</tr>
</table>
</div>

<h1 id="compileTimeValidation"><a class="anchor" href="#compileTimeValidation"></a>8 Validating Annotations at Compile Time</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/compileTimeValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Validation validates annotation elements at compile time with <code>micronaut-validation-processor</code> in the annotation processor classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.validation:micronaut-validation-processor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.validation&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-validation-processor&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Micronaut Validation will, at compile time, validate annotation values that are themselves annotated with <code>jakarta.validation</code>.
For example consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Validation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.lang.annotation.Retention;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Retention(RUNTIME)
public @interface TimeOff {
    @DurationPattern
    String duration();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Validation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Retention(RUNTIME)
@interface TimeOff {
    @DurationPattern
    String duration()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Validation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import kotlin.annotation.AnnotationRetention.RUNTIME

@Retention(RUNTIME)
annotation class TimeOff(
    @DurationPattern val duration: String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you attempt to use <code>@TimeOff(duration="junk")</code> in your source, Micronaut will fail compilation due to the <code>duration</code> value violating the <code>DurationPattern</code> constraint.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>duration</code> is a property placeholder such as <code>@TimeOff(duration="${my.value}")</code>, validation is deferred until runtime.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that to use a custom <code>ConstraintValidator</code> at compile time you must instead define the validator as a class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.AnnotationValue;
import io.micronaut.core.annotation.NonNull;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.validation.validator.constraints.ConstraintValidator;
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext;

public class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    public boolean isValid(
            @Nullable CharSequence value,
            @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @NonNull ConstraintValidatorContext context) {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.NonNull
import io.micronaut.core.annotation.Nullable
import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext

class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    boolean isValid(
            @Nullable CharSequence value,
            @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @NonNull ConstraintValidatorContext context) {
        return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext

class DurationPatternValidator : ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    override fun isValid(
        value: CharSequence?,
        annotationMetadata: AnnotationValue&lt;DurationPattern&gt;,
        context: ConstraintValidatorContext): Boolean {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a <code>META-INF/services/io.micronaut.validation.validator.constraints.ConstraintValidator</code> file that references the class.</p>
</li>
<li>
<p>The class must be public and have a public no-argument constructor</p>
</li>
<li>
<p>The class must be on the annotation processor classpath of the project to be validated.</p>
</li>
</ul>
</div>

<h1 id="repository"><a class="anchor" href="#repository"></a>9 Repository</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-validation/edit/4.8.x/src/main/docs/guide/repository.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can find the source code of this project in this repository:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-validation">https://github.com/micronaut-projects/micronaut-validation</a></p>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>
